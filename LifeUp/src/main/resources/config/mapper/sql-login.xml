<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd"> 

<mapper namespace="account">

	<select id="getUserInfo" resultType="salesman.vo.account.SessionVO">
		SELECT customer_id userId, customer_nm userNm, email, '1' userType, init_pwd, mobile
		  FROM CUSTOMER
		 WHERE customer_id = #{userId}		 
	</select>
	
	<select id="getSalesmanInfo" resultType="salesman.vo.account.SessionVO">
		SELECT salesman_id userId, salesman_nm userNm, email, vendor_id vendorId, location vendorLoc, '2' userType, init_pwd, mobile
		  FROM SALESMAN
		 WHERE salesman_id = #{userId}		 
	</select>
	
	<update id="modifyCustomerInfo">
		UPDATE CUSTOMER
		   SET EMAIL    = #{email}
		     , PWD      = #{password}
		     , MOBILE   = #{mobile}
		     , INIT_PWD = 'N'
		 WHERE CUSTOMER_ID = #{userId}
		   AND PWD         = #{prevPassword}
	</update>
	
	<update id="modifySalesmanInfo">
		UPDATE SALESMAN
		   SET EMAIL    = #{email}
		     , PWD      = #{password}
		     , MOBILE   = #{mobile}
		     , INIT_PWD = 'N'
		 WHERE SALESMAN_ID = #{userId}	
		   AND PWD         = #{prevPassword}
	</update>
	
	<select id="getUser" resultType="salesman.vo.account.SessionVO">
		SELECT customer_id userId, customer_nm userNm, email, '1' userType
		  FROM CUSTOMER
		 WHERE customer_id = #{userId}		 
		   AND pwd         = #{password}
	</select>
	
	<select id="getSalesman" resultType="salesman.vo.account.SessionVO">
		SELECT salesman_id userId, salesman_nm userNm, email, vendor_id vendorId, location vendorLoc, '2' userType
		  FROM SALESMAN
		 WHERE salesman_id = #{userId}	
		   AND pwd         = #{password}	 
	</select>	

	<select id="getUserByEmail" resultType="salesman.vo.account.SessionVO">
		SELECT customer_id userId, customer_nm userNm, email, '1' userType
		  FROM CUSTOMER
		 WHERE email = #{email}
	</select>

	<select id="getUserById" resultType="salesman.vo.account.SessionVO">
		SELECT customer_id userId, customer_nm userNm, email, '1' userType
		  FROM CUSTOMER
		 WHERE customer_id = #{userId}		 
	</select>
		
	<select id="getSalesmanByEmail" resultType="salesman.vo.account.SessionVO">
		SELECT salesman_id userId, salesman_nm userNm, email, vendor_id vendorId, location vendorLoc, '2' userType
		  FROM SALESMAN
		 WHERE email = #{email}	 
	</select>
	
	<select id="getSalesmanById" resultType="salesman.vo.account.SessionVO">
		SELECT salesman_id userId, salesman_nm userNm, email, vendor_id vendorId, location vendorLoc, '2' userType
		  FROM SALESMAN
		 WHERE salesman_id = #{userId}	 
	</select>
	
	<update id="modifySalesmanPasswd">
		UPDATE SALESMAN 
		   SET PWD      = #{password}
		     , INIT_PWD = CASE WHEN #{init_pwd} = 'Y' THEN 'Y'
			                   ELSE 'N'
			  	 	       END
		 WHERE SALESMAN_ID = #{userId}  
	</update>
	
	<update id="modifyCustomerPasswd">
		UPDATE CUSTOMER 
		   SET PWD      = #{password}
		     , INIT_PWD = CASE WHEN #{init_pwd} = 'Y' THEN 'Y'
			                   ELSE 'N'
			  	 	       END
		 WHERE CUSTOMER_ID = #{userId}  		 
	</update>		
	
	<insert id="registerCustomer">
		INSERT INTO customer (
			CUSTOMER_ID, CUSTOMER_NM, EMAIL, PWD, MOBILE, REGION, CREATE_DATE, UPDATE_DATE, INIT_PWD
		) VALUES (
			#{userId}, #{userNm}, #{email}, #{password},#{mobile},#{region},sysdate(), sysdate(), 'N'
		)			
	</insert>

	<insert id="registerSalesman">
		INSERT INTO salesman (
			SALESMAN_ID, SALESMAN_NM, EMAIL, PWD, MOBILE, OFFICE_NO, VENDOR_ID, LOCATION, INTRO_MSG, PHOTO, STAR_POINT, COMP_POINT, CREATE_DATE, UPDATE_DATE, INIT_PWD
		) VALUES (
			#{userId}, #{userNm}, #{email}, #{password},#{mobile},#{officeNo},#{vendorId},#{location},#{introMsg}, null, 0, 0, sysdate(), sysdate(), 'N'
		)			
	</insert>						
</mapper>